# ä¸Šä¼ åŠŸèƒ½é—®é¢˜ä¿®å¤æ€»ç»“

## ğŸ› å‘ç°çš„é—®é¢˜

ä»ä½ çš„æˆªå›¾å¯ä»¥çœ‹åˆ°ä»¥ä¸‹é”™è¯¯ï¼š

1. **JavaScripté”™è¯¯**: "Cannot read properties of undefined (reading 'source')"
2. **è¡¨å•éªŒè¯é”™è¯¯**: "è¯·å¡«å†™æ•°æ®é‡"
3. **APIé”™è¯¯**: "åˆ›å»ºæ•°æ®åŒæ¡£å¤±è´¥ï¼Œåç§°å¯èƒ½å·²å­˜åœ¨" (400 Bad Request)

## ğŸ”§ ä¿®å¤çš„é—®é¢˜

### 1. CancelToken é”™è¯¯ä¿®å¤
**é—®é¢˜**: ä½¿ç”¨äº†è¿‡æ—¶çš„ Axios CancelToken API
```javascript
// ä¿®å¤å‰ (æœ‰é—®é¢˜)
const CancelToken = api.CancelToken
const source = CancelToken.source()
uploadCancelToken = source
```

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ç°ä»£çš„ AbortController API
```javascript
// ä¿®å¤å
const abortController = new AbortController()
uploadAbortController = abortController
```

### 2. APIè·¯å¾„ä¸ä¸€è‡´ä¿®å¤
**é—®é¢˜**: `saveAndCreate` å‡½æ•°ä½¿ç”¨é”™è¯¯çš„APIè·¯å¾„
```javascript
// ä¿®å¤å‰ (é”™è¯¯çš„è·¯å¾„)
await api.post('/hdfs/corpus', formData)
await api.post('/hdfs/corpus/upload', uploadFormData)
```

**è§£å†³æ–¹æ¡ˆ**: ç»Ÿä¸€ä½¿ç”¨æ­£ç¡®çš„APIè·¯å¾„
```javascript
// ä¿®å¤å (æ­£ç¡®çš„è·¯å¾„)
await api.post('/corpus', formData)
await api.post('/corpus/upload', uploadFormData)
```

### 3. è¡¨å•éªŒè¯è§„åˆ™å®Œå–„
**é—®é¢˜**: ç¼ºå°‘å¿…è¦å­—æ®µçš„éªŒè¯è§„åˆ™
```javascript
// ä¿®å¤å‰ - ç¼ºå°‘éªŒè¯è§„åˆ™
dataVolume: '',
volumeUnit: '',
estimatedCapacityGb: '',
```

**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ å®Œæ•´çš„éªŒè¯è§„åˆ™
```javascript
// ä¿®å¤å - å®Œæ•´çš„éªŒè¯è§„åˆ™
dataVolume: [
  { required: true, message: 'è¯·å¡«å†™æ•°æ®é‡', trigger: 'blur' }
],
volumeUnit: [
  { required: true, message: 'è¯·å¡«å†™æ•°æ®é‡å•ä½', trigger: 'blur' }
],
estimatedCapacityGb: [
  { required: true, message: 'è¯·å¡«å†™å®¹é‡ä¼°ç®—', trigger: 'blur' }
],
```

### 4. æ•°æ®ç±»å‹ä¿®å¤
**é—®é¢˜**: æ•°å­—å­—æ®µä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹
```javascript
// ä¿®å¤å‰
dataVolume: '',
estimatedCapacityGb: '',
```

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨æ­£ç¡®çš„æ•°æ®ç±»å‹
```javascript
// ä¿®å¤å
dataVolume: null,
estimatedCapacityGb: null,
```

### 5. é”™è¯¯å¤„ç†æ›´æ–°
**é—®é¢˜**: é”™è¯¯åç§°ä¸åŒ¹é…
```javascript
// ä¿®å¤å‰
if (error.name === 'CanceledError') {
```

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨æ­£ç¡®çš„é”™è¯¯åç§°
```javascript
// ä¿®å¤å
if (error.name === 'AbortError') {
```

### 6. æ¸…ç†æ— ç”¨ä»£ç 
- åˆ é™¤äº†æœªä½¿ç”¨çš„ `customUpload` å‡½æ•°
- åˆ é™¤äº†æœªä½¿ç”¨çš„ `uploadData` å˜é‡

## ğŸ“‹ åç«¯APIæ˜ å°„ç¡®è®¤

æ ¹æ®æ§åˆ¶å™¨ä»£ç ï¼Œæ­£ç¡®çš„APIç«¯ç‚¹æ˜¯ï¼š

| åŠŸèƒ½ | HTTPæ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|----------|------|------|
| åˆ›å»ºè¯­æ–™ | POST | `/api/corpus` | åˆ›å»ºè¯­æ–™è®°å½• |
| ä¸Šä¼ æ–‡ä»¶ | POST | `/api/corpus/upload` | ä¸Šä¼ æ–‡ä»¶åˆ°æŒ‡å®šè¯­æ–™ |

## ğŸ¯ ç°åœ¨çš„åŠŸèƒ½

ä¿®å¤åï¼Œä¸Šä¼ åŠŸèƒ½åº”è¯¥èƒ½å¤Ÿï¼š

1. âœ… **æ­£ç¡®éªŒè¯è¡¨å•**: æ‰€æœ‰å¿…å¡«å­—æ®µéƒ½æœ‰éªŒè¯è§„åˆ™
2. âœ… **åˆ›å»ºè¯­æ–™è®°å½•**: ä½¿ç”¨æ­£ç¡®çš„APIè·¯å¾„ `/api/corpus`
3. âœ… **ä¸Šä¼ æ–‡ä»¶**: ä½¿ç”¨æ­£ç¡®çš„APIè·¯å¾„ `/api/corpus/upload`
4. âœ… **æ˜¾ç¤ºè¿›åº¦**: å®æ—¶æ˜¾ç¤ºä¸Šä¼ è¿›åº¦å’ŒçŠ¶æ€
5. âœ… **å–æ¶ˆä¸Šä¼ **: æ”¯æŒç”¨æˆ·å–æ¶ˆä¸Šä¼ æ“ä½œ
6. âœ… **é”™è¯¯å¤„ç†**: æ­£ç¡®å¤„ç†å„ç§é”™è¯¯æƒ…å†µ

## ğŸš€ æµ‹è¯•å»ºè®®

1. **é‡å¯å‰ç«¯å¼€å‘æœåŠ¡å™¨** (å¦‚æœåœ¨è¿è¡Œä¸­)
2. **æ¸…é™¤æµè§ˆå™¨ç¼“å­˜** 
3. **å¡«å†™å®Œæ•´è¡¨å•ä¿¡æ¯**:
   - ç¡®ä¿æ‰€æœ‰å¿…å¡«å­—æ®µéƒ½å¡«å†™
   - æ•°æ®é‡å’Œå®¹é‡ä¼°ç®—å¡«å†™æ•°å­—
4. **é€‰æ‹©æ–‡ä»¶**: æµ‹è¯•å•ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ä¸Šä¼ 
5. **è§‚å¯Ÿè¿›åº¦**: æ£€æŸ¥ä¸Šä¼ è¿›åº¦æ˜¾ç¤ºæ˜¯å¦æ­£å¸¸

## ğŸ“ æ³¨æ„äº‹é¡¹

- ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ
- ç¡®ä¿æ–‡ä»¶å¤§å°ä¸è¶…è¿‡10GBé™åˆ¶
- å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
- æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

ä¿®å¤åçš„ä¸Šä¼ åŠŸèƒ½åº”è¯¥èƒ½æ­£å¸¸å·¥ä½œäº†ï¼ 